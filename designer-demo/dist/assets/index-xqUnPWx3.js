import{c as _,f as g,o as f,b as a,r as d,J as l,u as v,g as E,h as L}from"./vendor-DJw1WU7V.js";import{_ as h}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./monaco-Drzug6rq.js";import"./prettier-LvesegEC.js";const w={setup(){const e=d(!1),o=d("");return{openLogin:(s,i)=>(e.value=!0,o.value=i,new Promise((p,u)=>{s.mePromise.resolve=p,s.mePromise.reject=u})),closeLogin:()=>{e.value=!1},visible:e,url:o}}},C={key:0,class:"tiny-popup__wrapper"},P={class:"tiny-sso__box"},b={class:"tiny-sso__body"},D=["src"];function R(e,o,t,n,s,i){return n.visible?(f(),_("div",C,[a("div",P,[a("div",b,[a("iframe",{src:n.url,class:"tiny-sso__body-iframe",frameBorder:"0",scrolling:"no"},null,8,D)])])])):g("",!0)}const N=h(w,[["render",R],["__scopeId","data-v-7f9eec9d"]]),y={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_CDN_DOMAIN:"https://registry.npmmirror.com",VITE_CDN_TYPE:"npmmirror",VITE_USER_NODE_ENV:"production"},V=401,{BROADCAST_CHANNEL:I}=L,{post:O}=v({name:I.Notify}),r={promiseLogin:null,mePromise:{}};let c=null;const m=(e,o)=>{O({type:"error",title:"接口报错",message:`报错接口: ${e} 
报错信息: ${o??""}`})},S=e=>("production".includes("dev")&&e.url.match(/\/generate\//)&&(e.baseURL=""),window.vscodeBridge&&(e.baseURL=""),e),B=e=>{var o,t,n,s,i;return(o=e.data)!=null&&o.error?(m((t=e.config)==null?void 0:t.url,(s=(n=e==null?void 0:e.data)==null?void 0:n.error)==null?void 0:s.message),Promise.reject(e.data.error)):(i=e.data)==null?void 0:i.data},x=()=>{if(!window.lowcode){const e=document.createElement("div");document.body.appendChild(e),c=E(N).mount(e),window.lowcode={platformCenter:{Session:{rebuiltCallback:function(){c.closeLogin(),r.mePromise.resolve("login ok"),r.promiseLogin=null,r.mePromise={}}}}}}return new Promise((e,o)=>{r.promiseLogin||(r.promiseLogin=c.openLogin(r,"/api/rebuildSession"),r.promiseLogin.then(t=>{l.apis.request(t.config).then(e,o)}))})},T=e=>{var t;const{response:o}=e;if((o==null?void 0:o.status)===V){if(window.vscodeBridge)return Promise.resolve(!0);if(o!=null&&o.headers["x-login-url"])return x()}return m((t=e.config)==null?void 0:t.url,e==null?void 0:e.message),o!=null&&o.data.error?Promise.reject(o.data.error):Promise.reject(e.message)},A=(e=y)=>{var s;const o=e.VITE_ORIGIN,t=(s=e.MODE)==null?void 0:s.includes("dev");return{baseURL:o,withCredentials:t,headers:{...t&&{"x-lowcode-mode":"develop"},"x-lowcode-org":new URLSearchParams(location.search).get("tenant")}}},U=()=>{const e={axiosConfig:A(),interceptors:{request:[S],response:[[B,T]]}};return l.apis.setOptions(e),l},q=U();export{q as HttpService};
